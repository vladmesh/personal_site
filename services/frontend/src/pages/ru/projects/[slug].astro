---
import BaseLayout from '@layouts/BaseLayout.astro';
import { fetchProfile } from '@lib/profile/full';

export async function getStaticPaths() {
  const profile = await fetchProfile('ru');
  return profile.projects.map((project) => ({
    params: { slug: project.slug }
  }));
}

const { slug } = Astro.params;
const profile = await fetchProfile('ru');
const project = profile.projects.find((entry) => entry.slug === slug);

if (!project) {
  throw new Error(`Project not found: ${slug}`);
}

const ogImage = `/og/projects/${project.slug}.png`;
const contacts = profile.contacts;
---
<BaseLayout
  title={`${project.title} — кейс Влад Меш`}
  description={project.summary}
  lang="ru"
  ogImage={ogImage}
  contacts={contacts}
>
  <article class="prose prose-invert prose-headings:font-semibold prose-a:text-brand-light prose-a:no-underline">
    <header class="mb-8 border-b border-white/10 pb-6">
      {project.role ? (
        <p class="text-sm uppercase tracking-wider text-slate-400">{project.role}</p>
      ) : null}
      <h1 class="mt-2 text-4xl font-semibold text-white">{project.title}</h1>
      <p class="mt-3 text-slate-300">{project.summary}</p>
      {project.stack?.length ? (
        <div class="mt-4 flex flex-wrap gap-3 text-xs text-slate-300">
          {project.stack.map((item) => (
            <span class="rounded-full border border-white/10 px-3 py-1" key={item}>{item}</span>
          ))}
        </div>
      ) : null}
    </header>
    {project.description?.length ? (
      <div class="space-y-4 text-slate-200/90">
        {project.description.map((paragraph) => (
          <p>{paragraph}</p>
        ))}
      </div>
    ) : null}
    {project.links?.length ? (
      <footer class="mt-10 flex flex-wrap gap-4 text-sm font-medium">
        {project.links.map((link) => (
          <a
            key={link.href}
            href={link.href}
            class="inline-flex items-center gap-2 text-brand-light transition hover:text-brand"
            target="_blank"
            rel="noreferrer"
          >
            {typeof link.label === 'string' ? link.label : link.label?.ru}
          </a>
        ))}
      </footer>
    ) : null}
  </article>
</BaseLayout>
