---
import BaseLayout from '@layouts/BaseLayout.astro';
import Hero from '@components/Hero.astro';
import HomeSections from '@components/HomeSections.astro';
import { projects } from '@data/projects';
import { skillGroups } from '@data/skills';
import { testimonials } from '@data/testimonials';
import { buildHomeCopy } from '@data/home';
import { fetchContacts, getTelegramHandle, selectContact } from '@lib/profile/contacts';

const lang = 'ru';
const pageProjects = projects[lang];
const contacts = await fetchContacts(lang);
if (!contacts.items.length) {
  throw new Error('No contacts returned from API');
}
const telegram = selectContact(contacts, ['telegram']);
const email = selectContact(contacts, ['email']);
const primaryContact = selectContact(contacts, ['telegram', 'email']);
if (!telegram || !email || !primaryContact) {
  throw new Error('Required contacts (telegram/email) are missing in API response');
}
const content = buildHomeCopy(lang, {
  emailHref: email.href,
  emailText: email.display,
  telegramHref: telegram.href,
  telegramHandle: getTelegramHandle(telegram) ?? '',
  primaryContactHref: primaryContact.href
});
---
<BaseLayout
  title="Влад — Backend и AI-инженер"
  description="Backend, AI-агенты и платформа проектов. Резюме, проекты и контакты."
  lang={lang}
  ogImage="/og/home_ru.png"
  contacts={contacts}
>
  <Hero lang={lang} content={content.hero} />
  <HomeSections
    lang={lang}
    content={content}
    projects={pageProjects}
    skills={skillGroups}
    quotes={testimonials}
  />
</BaseLayout>
