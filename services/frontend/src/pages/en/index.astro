---
import BaseLayout from '@layouts/BaseLayout.astro';
import Hero from '@components/Hero.astro';
import HomeSections from '@components/HomeSections.astro';
import { buildHomeCopy } from '@data/home';
import { fetchProfile } from '@lib/profile/full';
import { getTelegramHandle, selectContact } from '@lib/profile/contacts';

const lang = 'en';
const profile = await fetchProfile(lang);
const contacts = profile.contacts;
const telegram = selectContact(contacts, ['telegram']);
const email = selectContact(contacts, ['email']);
const primaryContact = selectContact(contacts, ['telegram', 'email']);
if (!telegram || !email || !primaryContact) {
  throw new Error('Required contacts (telegram/email) are missing in API response');
}
const content = buildHomeCopy(
  lang,
  {
    emailHref: email.href,
    emailText: email.display,
    telegramHref: telegram.href,
    telegramHandle: getTelegramHandle(telegram) ?? '',
    primaryContactHref: primaryContact.href
  },
  {
    experience: profile.experience,
    resumeHref: profile.resumes[lang]
  }
);
---
<BaseLayout
  title="Vlad â€” Backend & AI Engineer"
  description="Backend engineering, AI agents, and consulting portfolio. Resume, selected projects, and contact links."
  lang={lang}
  ogImage="/og/home_en.png"
  contacts={contacts}
>
  <Hero lang={lang} content={content.hero} />
  <HomeSections
    lang={lang}
    content={content}
    projects={profile.projects}
    skills={profile.skills}
    quotes={profile.testimonials}
  />
</BaseLayout>
