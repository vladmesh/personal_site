# Инкрементальный план интеграции фронтенда и бэкенда

Контекст: фронт (Astro) уже тянет контакты из `/api/v1/profile/contacts`, остальной контент (опыт, проекты, навыки, отзывы, резюме) остаётся статикой в `services/frontend/src/data`. В БД есть модели и миграции, но наполнены только контакты. Цель — перенести оставшийся контент в бекенд и отдать фронту через API без разрывов по данным.

## Итерация 1. Данные в БД и сиды
- Проанализировать статичные файлы (`experience.ts`, `projects.ts`, `skills.ts`, `testimonials.ts`) и сопоставить с моделями (`WorkExperience`, `Project`, `Stack`, `Testimonial`, `Resume`). Добавить недостающие поля/индексы/enum-значения, если нужны для паритета.
- Подготовить Alembic-миграцию с сидом контента (RU/EN переводы, даты, связи со стэками, featured-флаг, ссылки на CV). Учесть сортировку (дата/`sort_order`).
- Обновить фикстуры/тестовые данные, чтобы тесты покрывали сиды (минимум smoke на чтение).
- Проверки: `make lint` / `make typecheck` / `make test` (или эквивалент в Docker), `make dev` и просмотр `docker compose logs backend` на отсутствие ошибок миграций/сидов.

## Итерация 2. API, удобное для фронта
- Добавить агрегирующий endpoint профиля (например, `/api/v1/profile/full?lang=ru|en`) или параметр `lang` на существующие endpoints, возвращающий уже отфильтрованные переводы и отсортированные коллекции. Оставить “сырые” endpoints для админки/будущего UI.
- Вернуть вместе с профилем активные резюме и основные контакты (фронту нужны CV-ссылки и fallback-контакты).
- Обновить схемы/валидацию, прописать сортировки и дефолтные fallback-и языка (если нет нужного — en → первый доступный).
- Тесты: unit+integration на новый endpoint/параметры, проверка сортировки/фильтрации. Затем `make lint` / `make typecheck` / `make test`, `make dev`, контроль логов backend.

## Итерация 3. Интеграция фронта с API
- Написать клиентские функции для нового API профиля (перенести fetchContacts в общий модуль). Перевести страницы `/ru` и `/en`, а также `/projects/*` на данные из API. Обработать ошибки/fallback: при 5xx показать заглушку/старые статики? (решить и задокументировать).
- Удалить/законсервировать статичные данные, которые полностью переехали на API, чтобы не было рассинхронизации; оставить только то, что пока не отдаёт бэкенд (analytics, demos, cv пути до перевода на API).
- Верификация: фронт билдится и работает на dev-стеке с реальным backend (`npm run build`/`npm run dev` если нужно), плюс общий прогон `make lint` / `make typecheck` / `make test`, `make dev`, проверка логов backend на ошибки запросов.

## Итерация 4. Наведение порядка и эксплуатация
- Обновить документацию: `.env` примеры, README, shared API spec, описание нового endpoint и требований к env переменным.
- Почистить legacy-код и зависимости, пересобрать CI (при необходимости добавить фронтовый lint/build шаг). Зафиксировать seed-процесс и регламент пополнения контента.
- Финальные проверки: полный набор тестов/линтов, `make dev`, просмотр логов backend и фронта на чистоту после холодного старта и пары запросов.
